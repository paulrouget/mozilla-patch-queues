# vim: se ft=diff :
# HG changeset patch
# User Spyros Livathinos <livathinos.spyros>
# Date 2012-02-04 04:23
Bug 403510 - "Implement scrollIntoViewIfNeeded" [f=livathinos.spyros]

diff -r e33539a90ae2 content/html/content/src/nsGenericHTMLElement.cpp
--- a/content/html/content/src/nsGenericHTMLElement.cpp	Sun Jan 29 20:42:00 2012 -0800
+++ b/content/html/content/src/nsGenericHTMLElement.cpp	Sat Feb 04 14:19:34 2012 +0200
@@ -991,16 +991,45 @@ nsGenericHTMLElement::ScrollIntoView(boo
 
   presShell->ScrollContentIntoView(this, vpercent,
                                    NS_PRESSHELL_SCROLL_ANYWHERE,
                                    nsIPresShell::SCROLL_OVERFLOW_HIDDEN);
 
   return NS_OK;
 }
 
+nsresult
+nsGenericHTMLElement::ScrollIntoViewIfNeeded(bool centerIfNeeded, PRUint8 optional_argc)
+{
+  nsIDocument *document = GetCurrentDoc();
+  
+  if (!document) {
+    return NS_OK;
+  }
+
+  // Get the presentation shell
+  nsCOMPtr<nsIPresShell> presShell = document->GetShell();
+  if (!presShell) {
+    return NS_OK;
+  }
+
+  if (!optional_argc) {
+    centerIfNeeded = true;
+  }
+
+  PRIntn vpercent = centerIfNeeded ? NS_PRESSHELL_SCROLL_CENTER :
+    NS_PRESSHELL_SCROLL_ANYWHERE;
+
+  presShell->ScrollContentIntoView(this, vpercent,
+                                   NS_PRESSHELL_SCROLL_ANYWHERE,
+                                   nsIPresShell::SCROLL_OVERFLOW_HIDDEN);
+
+  return NS_OK;
+ }
+
 NS_IMETHODIMP
 nsGenericHTMLElement::GetSpellcheck(bool* aSpellcheck)
 {
   NS_ENSURE_ARG_POINTER(aSpellcheck);
   *aSpellcheck = false;              // Default answer is to not spellcheck
 
   // Has the state has been explicitly set?
   nsIContent* node;
diff -r e33539a90ae2 content/html/content/src/nsGenericHTMLElement.h
--- a/content/html/content/src/nsGenericHTMLElement.h	Sun Jan 29 20:42:00 2012 -0800
+++ b/content/html/content/src/nsGenericHTMLElement.h	Sat Feb 04 14:19:34 2012 +0200
@@ -131,16 +131,17 @@ public:
   nsresult GetOffsetParent(nsIDOMElement** aOffsetParent);
   NS_IMETHOD GetInnerHTML(nsAString& aInnerHTML);
   NS_IMETHOD SetInnerHTML(const nsAString& aInnerHTML);
   NS_IMETHOD GetOuterHTML(nsAString& aOuterHTML);
   NS_IMETHOD SetOuterHTML(const nsAString& aOuterHTML);
   NS_IMETHOD InsertAdjacentHTML(const nsAString& aPosition,
                                 const nsAString& aText);
   nsresult ScrollIntoView(bool aTop, PRUint8 optional_argc);
+  nsresult ScrollIntoViewIfNeeded(bool centerIfNeeded, PRUint8 optional_argc);
   nsresult MozRequestFullScreen();
   // Declare Focus(), Blur(), GetTabIndex(), SetTabIndex(), GetHidden(),
   // SetHidden(), GetSpellcheck(), SetSpellcheck(), and GetDraggable() such that
   // classes that inherit interfaces with those methods properly override them.
   NS_IMETHOD Focus();
   NS_IMETHOD Blur();
   NS_IMETHOD Click();
   NS_IMETHOD GetTabIndex(PRInt32 *aTabIndex);
@@ -1541,16 +1542,19 @@ PR_STATIC_ASSERT(ELEMENT_TYPE_SPECIFIC_B
   NS_SCRIPTABLE NS_IMETHOD SetOuterHTML(const nsAString& aOuterHTML) { \
     return _to SetOuterHTML(aOuterHTML); \
   } \
   NS_SCRIPTABLE NS_IMETHOD InsertAdjacentHTML(const nsAString& position, const nsAString& text) { \
     return _to InsertAdjacentHTML(position, text); \
   } \
   NS_SCRIPTABLE NS_IMETHOD ScrollIntoView(bool top, PRUint8 _argc) { \
     return _to ScrollIntoView(top, _argc); \
+  } \  
+  NS_SCRIPTABLE NS_IMETHOD ScrollIntoViewIfNeeded(bool centerIfNeeded, PRUint8 _argc) { \
+    return _to ScrollIntoViewIfNeeded(centerIfNeeded, _argc); \
   } \
   NS_SCRIPTABLE NS_IMETHOD GetOffsetParent(nsIDOMElement** aOffsetParent) { \
     return _to GetOffsetParent(aOffsetParent); \
   } \
   NS_SCRIPTABLE NS_IMETHOD GetOffsetTop(PRInt32* aOffsetTop) { \
     return _to GetOffsetTop(aOffsetTop); \
   } \
   NS_SCRIPTABLE NS_IMETHOD GetOffsetLeft(PRInt32* aOffsetLeft) { \
diff -r e33539a90ae2 dom/interfaces/html/nsIDOMHTMLElement.idl
--- a/dom/interfaces/html/nsIDOMHTMLElement.idl	Sun Jan 29 20:42:00 2012 -0800
+++ b/dom/interfaces/html/nsIDOMHTMLElement.idl	Sat Feb 04 14:19:34 2012 +0200
@@ -88,16 +88,17 @@ interface nsIDOMHTMLElement : nsIDOMElem
            attribute DOMString        innerHTML;
            attribute DOMString        outerHTML;
   void insertAdjacentHTML(in DOMString position,
                           in DOMString text);
 
 
   // CSSOM View
   [optional_argc] void scrollIntoView([optional] in boolean top);
+  [optional_argc] void scrollIntoViewIfNeeded([optional] in boolean centerIfNeeded);
   readonly attribute nsIDOMElement    offsetParent;
   readonly attribute long             offsetTop;
   readonly attribute long             offsetLeft;
   readonly attribute long             offsetWidth;
   readonly attribute long             offsetHeight;
 
 
   // Mozilla extensions

